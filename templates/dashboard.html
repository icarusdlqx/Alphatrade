{% extends "base.html" %}
{% block content %}
<style>
.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}
.status-card {
  padding: 1.5rem;
  text-align: center;
  border-radius: 12px;
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
}
.status-card.connected {
  background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
  border: 1px solid #28a745;
}
.status-card.disconnected {
  background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
  border: 1px solid #dc3545;
}
.status-title {
  font-size: 1.2rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
}
.control-panel {
  background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
  padding: 2rem;
  border-radius: 12px;
  text-align: center;
  margin-bottom: 2rem;
  border: 1px solid #2196f3;
}
.run-button {
  font-size: 1.1rem;
  padding: 15px 30px;
  margin-bottom: 1rem;
  background: linear-gradient(135deg, #0066cc 0%, #004499 100%);
  box-shadow: 0 4px 12px rgba(0,102,204,0.3);
}
.timing-info {
  display: flex;
  justify-content: center;
  gap: 2rem;
  flex-wrap: wrap;
}
.config-list {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1rem;
  list-style: none;
  padding: 0;
}
.config-item {
  background: #f8f9fa;
  padding: 1rem;
  border-radius: 8px;
  border-left: 4px solid var(--primary-color);
}
.config-label {
  font-weight: 600;
  color: var(--primary-color);
  margin-bottom: 0.25rem;
}
.config-value {
  color: var(--text-muted);
  font-family: monospace;
}
</style>

<section>
  <h4>üîß System Status</h4>
  <div class="dashboard-grid">
    <article class="status-card {{ 'connected' if ok_alpaca else 'disconnected' }}">
      <div class="status-title">
        <span class="status-dot {{ 'green' if ok_alpaca else 'red' }}"></span>
        Alpaca Trading
      </div>
      <p class="muted">{{ alpaca_msg }}</p>
    </article>
    <article class="status-card {{ 'connected' if ok_openai else 'disconnected' }}">
      <div class="status-title">
        <span class="status-dot {{ 'green' if ok_openai else 'red' }}"></span>
        OpenAI API
      </div>
      <p class="muted">{{ openai_msg }}</p>
    </article>
  </div>
</section>

<section>
  <h4>üöÄ Trading Controls</h4>
  <div class="control-panel">
    <form method="post" action="{{ url_for('run_now') }}">
      <button class="run-button">üîç Run Analysis Now</button>
    </form>
    <div class="timing-info">
      <div>
        <strong>Last Analysis:</strong>
        <span class="badge">{{ last_run }}</span>
      </div>
      <div>
        <strong>Next Window:</strong>
        <span class="badge">{{ next_run }}</span>
      </div>
    </div>
  </div>
</section>

<section>
  <h4>‚öôÔ∏è Configuration Summary</h4>
  <ul class="config-list">
    <li class="config-item">
      <div class="config-label">System Status</div>
      <div class="config-value">{{ 'Enabled ‚úÖ' if settings.ENABLED else 'Disabled ‚ùå' }}</div>
    </li>
    <li class="config-item">
      <div class="config-label">Trading Windows (ET)</div>
      <div class="config-value">{{ settings.WINDOWS_ET }}</div>
    </li>
    <li class="config-item">
      <div class="config-label">Near-Bell Buffer</div>
      <div class="config-value">{{ settings.AVOID_NEAR_OPEN_CLOSE_MIN }} minutes</div>
    </li>
    <li class="config-item">
      <div class="config-label">Portfolio Limits</div>
      <div class="config-value">{{ settings.TARGET_POSITIONS }} positions, {{ (settings.MAX_WEIGHT*100)|round(0) }}% max weight</div>
    </li>
    <li class="config-item">
      <div class="config-label">Risk Controls</div>
      <div class="config-value">{{ (settings.TURNOVER_LIMIT*100)|round(0) }}% turnover cap, ${{ settings.MIN_ORDER_NOTIONAL }} min order</div>
    </li>
    <li class="config-item">
      <div class="config-label">Regime Filter</div>
      <div class="config-value">{{ 'Active' if settings.REGIME_FILTER else 'Inactive' }} ({{ (settings.RISK_OFF_SCALAR*100)|round(0) }}% risk-off)</div>
    </li>
  </ul>
</section>
{% endblock %}